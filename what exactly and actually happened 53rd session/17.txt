
Action: $ head -26020 "/app/Lichess Bot-AlphaZero-Pure.user.js" | tail -70 | head -50
Observation:     
    const dx = Math.sign(f2 - f1);
    const dy = Math.sign(r2 - r1);
    
    return { dx, dy };
}

/**
 * v40.35 Helper: Get square beyond in a direction
 */
function getSquareBeyond(square, direction) {
    const file = square[0].charCodeAt(0) - 97;
    const rank = parseInt(square[1]) - 1;
    
    const newFile = file - direction.dx;
    const newRank = rank - direction.dy;
    
    if (newFile < 0 || newFile > 7 || newRank < 0 || newRank > 7) return null;
    
    return String.fromCharCode(97 + newFile) + (newRank + 1);
}

// ═══════════════════════════════════════════════════════════════════════════════
    const attacked = [];
    const isWhite = color === 'w';
    const enemyColor = isWhite ? 'b' : 'w';
    
    for (const [square, piece] of board) {
        if (!piece) continue;
        const pieceIsWhite = piece === piece.toUpperCase();
        if (pieceIsWhite !== isWhite) continue;
        
        const pieceType = piece.toLowerCase();
        if (pieceType === 'k') continue;  // King attacks handled separately
        
        // Check if this square is attacked by enemy
        if (isSquareAttackedByColor(board, square, enemyColor)) {
            // Check if it's adequately defended
            const isDefended = isSquareDefendedByColor(board, square, color);
            
            // If attacked by something of lower value, still need to consider
            const attackers = findAttackersOfSquare(board, square, enemyColor);
            const lowestAttackerValue = Math.min(...attackers.map(a => getPieceValueSimple(a.piece.toLowerCase())));
            const ourPieceValue = getPieceValueSimple(pieceType);
            
            // Consider it under attack if:
            // 1. Not defended at all, or
            // 2. Attacker is of lower value than our piece
            if (!isDefended || lowestAttackerValue < ourPieceValue) {
                attacked.push({
Exit code: 0