Now let me check the mating net detection function to enhance it for better corner mate pattern detection:
Action: file_editor view /app/Lichess Bot-AlphaZero-Pure.user.js
Observation: /app/Lichess Bot-AlphaZero-Pure.user.js:
4000|                
4001|                // Adjacent file to king
4002|                if (Math.abs(pieceFile - kingFile) === 1) {
4003|                    penalty -= 400;  // NEW: Adjacent file threat
4004|                    debugLog("[V40_MATING_NET]", `âš ï¸ Enemy ${pieceType} on adjacent file to king`);
4005|                }
4006|                
4007|                // Enemy rook/queen on 2nd/7th rank (infiltration) â€” STRONGER
4008|                const infiltrationRank = activeColor === 'w' ? 1 : 6;
4009|                if (pieceRank === infiltrationRank) {
4010|                    penalty -= 1200;  // Increased from 600
4011|                    debugLog("[V40_MATING_NET]", `ðŸš¨ðŸš¨ Enemy ${pieceType} INFILTRATED to ${infiltrationRank + 1} rank!`);
4012|                }
4013|                
4014|                // Double rooks on a file = CATASTROPHIC
4015|                if (pieceType === 'r') {
4016|                    for (const [sq2, p2] of simBoard) {
4017|                        if (sq2 === square) continue;
4018|                        if (p2 && p2.toLowerCase() === 'r') {
4019|                            const isEnemy2 = (p2 === p2.toUpperCase()) === (enemyColor === 'w');
4020|                            if (isEnemy2) {
4021|                                const file2 = sq2.charCodeAt(0) - 'a'.charCodeAt(0);
4022|                                if (file2 === pieceFile) {
4023|                                    penalty -= 2000;  // Increased from 1000
4024|                                    debugLog("[V40_MATING_NET]", `ðŸš¨ðŸš¨ðŸš¨ DOUBLED ROOKS on ${String.fromCharCode(pieceFile + 97)}-file!`);
4025|                                }
4026|                            }
4027|                        }
4028|                    }
4029|                }
4030|            }
4031|        }
4032|        
4033|        // CHECK 4: SPECIFIC MATING PATTERN: Rook + King coordination
4034|        // Looking for patterns like Ra2+, Ra1# that happened in the game
4035|        const enemyRooks = [];
4036|        const enemyQueen = [];
4037|        for (const [square, piece] of simBoard) {
4038|            if (!piece) continue;
4039|            const isEnemy = (piece === piece.toUpperCase()) === (enemyColor === 'w');
4040|            if (isEnemy && piece.toLowerCase() === 'r') {
4041|                enemyRooks.push(square);
4042|            }
4043|            if (isEnemy && piece.toLowerCase() === 'q') {
4044|                enemyQueen.push(square);
4045|            }
4046|        }
4047|        
4048|        // v40.2: ENHANCED CHECK - Multiple heavy pieces near cornered king
4049|        if (isCornerArea) {
4050|            const heavyPiecesNearby = enemyRooks.filter(rookSq => {
4051|                const rookFile = rookSq.charCodeAt(0) - 'a'.charCodeAt(0);
4052|                const rookRank = parseInt(rookSq[1]) - 1;
4053|                return Math.abs(rookFile - kingFile) <= 2 && Math.abs(rookRank - kingRank) <= 2;
4054|            }).length;
4055|            
4056|            if (heavyPiecesNearby >= 2) {
4057|                penalty -= 3500;  // Two+ rooks converging = mate imminent
4058|                debugLog("[V40_MATING_NET]", `ðŸš¨ðŸš¨ðŸš¨ MATING NET: ${heavyPiecesNearby} rooks converging on cornered king!`);
4059|            } else if (heavyPiecesNearby === 1) {
4060|                penalty -= 1800;
4061|                debugLog("[V40_MATING_NET]", `ðŸš¨ðŸš¨ MATING NET FORMING: Rook near cornered king!`);
4062|            }
4063|        }
4064|        
4065|        // v40.2: CHECK 5 - King on a-file or h-file with rook on same rank
4066|        if (kingFile === 0 || kingFile === 7) {  // a-file or h-file
4067|            for (const rookSq of enemyRooks) {
4068|                const rookRank = parseInt(rookSq[1]) - 1;
4069|                if (rookRank === kingRank) {
4070|                    penalty -= 2500;  // Rook giving check on edge = likely mate
4071|                    debugLog("[V40_MATING_NET]", `ðŸš¨ðŸš¨ðŸš¨ ROOK ON SAME RANK AS EDGE KING - MATE THREAT!`);
4072|                }
4073|            }
4074|        }
4075|        
4076|        // v40.2: CHECK 6 - Staircase/ladder mate pattern detection
4077|        // Two rooks alternating ranks cutting off escape
4078|        if (enemyRooks.length >= 2) {
4079|            const rookRanks = enemyRooks.map(sq => parseInt(sq[1]) - 1).sort((a, b) => a - b);
4080|            const rankSpread = rookRanks[rookRanks.length - 1] - rookRanks[0];
4081|            
4082|            if (rankSpread <= 3 && Math.abs(rookRanks[0] - kingRank) <= 2) {
4083|                penalty -= 2000;  // Ladder mate forming
4084|                debugLog("[V40_MATING_NET]", `ðŸš¨ðŸš¨ LADDER MATE PATTERN DETECTED!`);
4085|            }
4086|        }
4087|        
4088|    } catch (e) {
4089|        debugLog("[V40_MATING_NET]", `Error: ${e.message}`);
4090|    }
4091|    
4092|    return penalty;
4093|}
4094|
4095|/**
4096| * v40.1: FILE CONTROL EVALUATION
4097| * Prevents blindness to dangerous file invasions like the c-file in the lost game
4098| * Evaluates open file control and file invasion threats
4099| */
4100|function v40FileControlEvaluation(fen, move, board, activeColor) {
4101|    let score = 0;
4102|    const enemyColor = activeColor === 'w' ? 'b' : 'w';
4103|    
4104|    try {
4105|        // Simulate the move
4106|        const simBoard = new Map(board);
4107|        const fromSquare = move.substring(0, 2);
4108|        const toSquare = move.substring(2, 4);
4109|        const movingPiece = board.get(fromSquare);
4110|        
4111|        if (movingPiece) {
4112|            simBoard.delete(fromSquare);
4113|            simBoard.set(toSquare, movingPiece);
4114|        }
4115|        
4116|        // Analyze each file (a-h)
4117|        for (let fileIdx = 0; fileIdx < 8; fileIdx++) {
4118|            const fileLetter = String.fromCharCode(97 + fileIdx);
4119|            
4120|            // Count pieces on this file
