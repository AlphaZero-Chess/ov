I see the issue. The logic at lines 45821-45833 tries to find an alternative if bestMove is rejected, but if NO alternative passes the filter, we never update bestMove. Then at line 45843-45844, if `alternatives.length < 2`, we return bestMove (which might still be the rejected move!).

Let me fix this critical bug and implement v40.47:
Action: file_editor str_replace /app/Lichess Bot-AlphaZero-Pure.user.js --old-str "        // Check if bestMove should be rejected
        if (shouldRejectMove(bestMove)) {
            debugLog(\"[V40.31_FILTER]\", `ğŸš« Best move ${bestMove} REJECTED by hard filter!`);
            
            // Find first alternative that passes the filter
            for (let i = 1; i < alternatives.length; i++) {
                const altMove = alternatives[i].move;
                if (!shouldRejectMove(altMove)) {
                    debugLog(\"[V40.31_FILTER]\", `âœ… Using alternative: ${altMove} (filtered out ${bestMove})`);
                    bestMove = altMove;
                    break;
                }
            }
        }
        
        // Also filter ALL alternatives to remove bad moves from consideration
        alternatives = alternatives.filter(alt => !shouldRejectMove(alt.move));
        
        debugLog(\"[V40.31_FILTER]\", `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
    }
    
    // Don't be creative if we only have one option
    if (alternatives.length < 2) {
        return bestMove;
    }" --new-str "        // Check if bestMove should be rejected
        let bestMoveWasRejected = false;
        if (shouldRejectMove(bestMove)) {
            debugLog(\"[V40.47_FILTER]\", `ğŸš« Best move ${bestMove} REJECTED by hard filter!`);
            bestMoveWasRejected = true;
            
            // Find first alternative that passes the filter
            for (let i = 1; i < alternatives.length; i++) {
                const altMove = alternatives[i].move;
                if (!shouldRejectMove(altMove)) {
                    debugLog(\"[V40.47_FILTER]\", `âœ… Using alternative: ${altMove} (filtered out ${bestMove})`);
                    bestMove = altMove;
                    bestMoveWasRejected = false;
                    break;
                }
            }
        }
        
        // Also filter ALL alternatives to remove bad moves from consideration
        const filteredAlternatives = alternatives.filter(alt => !shouldRejectMove(alt.move));
        
        // v40.47 CRITICAL FIX: If bestMove was rejected and no alternative found, 
        // search through ALL legal moves to find a valid recapture!
        if (bestMoveWasRejected && filteredAlternatives.length === 0) {
            debugLog(\"[V40.47_FILTER]\", `ğŸš¨ ALL moves filtered! Searching for valid recapture...`);
            
            // Find the central square that needs recapturing
            const isWhite = currentFen.includes(' w ');
            const centralSquares = isWhite ? ['d4', 'e4'] : ['d5', 'e5'];
            
            for (const centralSq of centralSquares) {
                const piece = filterBoard.get(centralSq);
                if (!piece || piece.toLowerCase() !== 'p') continue;
                
                const pieceIsWhite = piece === piece.toUpperCase();
                if (pieceIsWhite === isWhite) continue;
                
                // Found enemy pawn - find a piece that can capture it
                for (const alt of alternatives) {
                    const toSq = alt.move.substring(2, 4);
                    if (toSq === centralSq) {
                        debugLog(\"[V40.47_FILTER]\", `âœ… FORCE RECAPTURE: ${alt.move} captures ${centralSq}!`);
                        bestMove = alt.move;
                        bestMoveWasRejected = false;
                        break;
                    }
                }
                if (!bestMoveWasRejected) break;
            }
        }
        
        alternatives = filteredAlternatives.length > 0 ? filteredAlternatives : alternatives;
        
        debugLog(\"[V40.47_FILTER]\", `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
    }
    
    // Don't be creative if we only have one option
    if (alternatives.length < 2) {
        return bestMove;
    }"
Observation: Edit was successful.