
Action: file_editor view /app/Lichess Bot-AlphaZero-Pure.user.js
Observation: /app/Lichess Bot-AlphaZero-Pure.user.js:
22430|                v40MatingNetPenalty = v40DeepMatingNetDetection(fen, move, board, activeColor) * 1.5;
22431|                
22432|                // v40.3: FILE CONTROL EVALUATION (prevents c-file invasion blindness)
22433|                // CRITICAL: Increased to 1.0 â€” file control is CRUCIAL
22434|                v40FileControlBonus = v40FileControlEvaluation(fen, move, board, activeColor) * 1.0;
22435|                
22436|                // v40.3: INITIATIVE TRACKING (prevents initiative collapse)
22437|                // CRITICAL: Increased to 1.2 â€” initiative loss = position loss
22438|                v40InitiativeBonus = v40DeepInitiativeTracking(fen, move, board, activeColor, moveNumber) * 1.2;
22439|                
22440|                // v40.3: QUEEN MOVEMENT PENALTY (prevents Qd1-Qd3-Qe4-Qd3 disasters)
22441|                // CRITICAL: Multiplied by 2.0 â€” queen movement must be HEAVILY penalized
22442|                const queenPenalty = v40QueenMovementPenalty(fen, move, board, activeColor, moveNumber) * 2.0;
22443|                
22444|                // v40.3: PROPHYLACTIC BONUS (preventing opponent's plans)
22445|                const prophylacticBonus = v40ProphylacticEvaluation(fen, move, board, activeColor, moveNumber) * 0.8;
22446|                
22447|                // v40.3: ROOK INFILTRATION DETECTION
22448|                const rookInfiltrationPenalty = v40RookInfiltrationDetection(fen, move, board, activeColor) * 1.0;
22449|                
22450|                // v40.3: KING SAFETY CORRIDOR
22451|                const kingSafetyCorridorPenalty = v40KingSafetyCorridorEval(fen, move, board, activeColor) * 0.9;
22452|                
22453|                // v40.3 NEW: ANTI-PASSIVITY SYSTEM â€” Forces active play
22454|                const antiPassivityBonus = v40AntiPassivityEvaluation(fen, move, board, activeColor, moveNumber) * 0.8;
22455|                
22456|                // v40.3 NEW: DEEP HORIZON EVALUATION â€” True 30+ move planning
22457|                const deepHorizonBonus = v40DeepHorizonEvaluation(fen, move, board, activeColor, moveNumber) * 0.6;
22458|                
22459|                // v40.3 NEW: SPACE DOMINATION â€” Territory control
22460|                const spaceDominationBonus = v40SpaceDominationEvaluation(fen, move, board, activeColor) * 0.5;
22461|                
22462|                // v40.3 NEW: COUNTERATTACK PRIORITY â€” Active defense is best defense
22463|                const counterattackBonus = v40CounterattackEvaluation(fen, move, board, activeColor, moveNumber) * 0.7;
22464|                
22465|                // v40.3 NEW: INITIATIVE PRESERVATION â€” Never lose the initiative
22466|                const initiativePreservationBonus = v40InitiativePreservationEvaluation(fen, move, board, activeColor, moveNumber) * 0.6;
22467|                
22468|                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
22469|                // v40.4 GODLIKE: NEW TACTICAL & POSITIONAL BLINDSPOT PREVENTION
22470|                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
22471|                
22472|                // v40.4: OPENING PRINCIPLES â€” Enforce principled play (prevents d3 disasters)
22473|                const openingPrinciplesScore = v40OpeningPrinciplesEvaluation(fen, move, board, activeColor, moveNumber) * 0.9;
22474|                
22475|                // v40.4: ENHANCED DISCOVERED ATTACK DETECTION â€” Prevents Nxg3+ type blindspots
22476|                const discoveredAttackPenalty = v40EnhancedDiscoveredAttackDetection(fen, move, board, activeColor) * 1.0;
22477|                
22478|                // v40.4: KNIGHT INVASION PENALTY â€” Prevent enemy knight infiltration
22479|                const knightInvasionPenalty = v40KnightInvasionPenalty(fen, move, board, activeColor) * 0.8;
22480|                
22481|                // v40.4: ENHANCED QUEEN MATING PATTERNS â€” Detect Qxg2# type mates
22482|                const queenMatingPenalty = v40EnhancedQueenMatingPatterns(fen, move, board, activeColor) * 0.9;
22483|                
22484|                // v40.4: PAWN SHIELD INTEGRITY â€” Critical for king safety
22485|                const pawnShieldScore = v40PawnShieldIntegrityEval(fen, move, board, activeColor) * 0.7;
22486|                
22487|                // v40.4: COMBINED v40 SCORE â€” 80% GODLIKE DOMINANT INFLUENCE
22488|                // This makes v40 the ABSOLUTE DOMINANT factor in move selection
22489|                v40DeepScore = v40Score + v40MatingNetPenalty + v40FileControlBonus + 
22490|                               v40InitiativeBonus + queenPenalty + prophylacticBonus + 
22491|                               rookInfiltrationPenalty + kingSafetyCorridorPenalty +
22492|                               antiPassivityBonus + deepHorizonBonus + spaceDominationBonus +
22493|                               counterattackBonus + initiativePreservationBonus +
22494|                               // v40.4 NEW additions:
22495|                               openingPrinciplesScore + discoveredAttackPenalty + 
22496|                               knightInvasionPenalty + queenMatingPenalty + pawnShieldScore;
22497|                v40Bonus = v40DeepScore * 0.80;  // 80% influence â€” GODLIKE PARADIGM SHIFT
22498|                
22499|                debugLog("[V40_INTEGRATE]", `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
22500|                debugLog("[V40_INTEGRATE]", `ðŸ¦ SUPERHUMAN BEAST v40.4 GODLIKE EVALUATION`);
22501|                debugLog("[V40_INTEGRATE]", `Move ${move}:`);
22502|                debugLog("[V40_INTEGRATE]", `   Base v40: ${v40Score.toFixed(1)}`);
22503|                debugLog("[V40_INTEGRATE]", `   MatingNet: ${v40MatingNetPenalty.toFixed(1)}`);
22504|                debugLog("[V40_INTEGRATE]", `   FileControl: ${v40FileControlBonus.toFixed(1)}`);
22505|                debugLog("[V40_INTEGRATE]", `   Initiative: ${v40InitiativeBonus.toFixed(1)}`);
22506|                debugLog("[V40_INTEGRATE]", `   QueenPenalty: ${queenPenalty.toFixed(1)}`);
22507|                debugLog("[V40_INTEGRATE]", `   Prophylactic: ${prophylacticBonus.toFixed(1)}`);
22508|                debugLog("[V40_INTEGRATE]", `   RookInfiltration: ${rookInfiltrationPenalty.toFixed(1)}`);
22509|                debugLog("[V40_INTEGRATE]", `   KingSafetyCorridor: ${kingSafetyCorridorPenalty.toFixed(1)}`);
22510|                debugLog("[V40_INTEGRATE]", `   AntiPassivity: ${antiPassivityBonus.toFixed(1)}`);
22511|                debugLog("[V40_INTEGRATE]", `   DeepHorizon: ${deepHorizonBonus.toFixed(1)}`);
22512|                debugLog("[V40_INTEGRATE]", `   SpaceDomination: ${spaceDominationBonus.toFixed(1)}`);
22513|                debugLog("[V40_INTEGRATE]", `   Counterattack: ${counterattackBonus.toFixed(1)}`);
22514|                debugLog("[V40_INTEGRATE]", `   InitiativePreserve: ${initiativePreservationBonus.toFixed(1)}`);
22515|                debugLog("[V40_INTEGRATE]", `   ðŸ†• OpeningPrinciples: ${openingPrinciplesScore.toFixed(1)}`);
22516|                debugLog("[V40_INTEGRATE]", `   ðŸ†• DiscoveredAttack: ${discoveredAttackPenalty.toFixed(1)}`);
22517|                debugLog("[V40_INTEGRATE]", `   ðŸ†• KnightInvasion: ${knightInvasionPenalty.toFixed(1)}`);
22518|                debugLog("[V40_INTEGRATE]", `   ðŸ†• QueenMating: ${queenMatingPenalty.toFixed(1)}`);
22519|                debugLog("[V40_INTEGRATE]", `   ðŸ†• PawnShield: ${pawnShieldScore.toFixed(1)}`);
22520|                debugLog("[V40_INTEGRATE]", `   TOTAL v40: ${v40DeepScore.toFixed(1)} â†’ 80% bonus=${v40Bonus.toFixed(1)}cp`);
22521|                debugLog("[V40_INTEGRATE]", `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
22522|            } catch (e) {
22523|                debugLog("[V40_INTEGRATE]", `âš ï¸ v40 evaluation error: ${e.message}`);
22524|                v40Bonus = 0;
22525|            }
22526|        }
22527|        
22528|        // v40.4: TRUE ALPHAZERO GODLIKE weighted merge â€” v40 GODLIKE DOMINANT (80%)
22529|        // Engine provides minimal baseline, but v40 superhuman evaluation is ABSOLUTE DOMINANT
22530|        const combinedScore = (
22531|            TRUE_ALPHAZERO.qWeight * engine_Q * 0.20 +  // Engine reduced to 20%
22532|            TRUE_ALPHAZERO.rolloutWeight * rollout_Q * 0.20 +
22533|            normalizedPolicyPrior * 0.4 + // Policy bonus reduced further
22534|            v40Bonus                      // v40 GODLIKE DOMINANT at 80%
22535|        );
22536|        
22537|        debugLog("[Q+POLICY]", `Move ${move}: Q=${engine_Q.toFixed(1)}cp, rollout=${rollout_Q.toFixed(1)}cp, policy=${policyPrior.toFixed(3)}, v40=${v40Bonus.toFixed(1)} â†’ combined=${combinedScore.toFixed(1)}cp`);
22538|        
22539|        return combinedScore;
22540|    } catch (e) {
22541|        debugLog("[Q+POLICY]", "âš ï¸ Error computing combined score:", e.message);
22542|        return engineScore;
22543|    }
22544|}
22545|
22546|/**
22547| * NEW v18.0.0: Legacy stub for v17 compatibility
22548| */
22549|function computeLongHorizonScore(fen, move, alternatives, engineScore) {
22550|    debugLog("[LEGACY]", "âš ï¸ computeLongHorizonScore called (use computeCombinedScore in v18)");
22551|    return computeCombinedScore(fen, move, alternatives, engineScore, engineScore);
22552|}
22553|
22554|/**
22555| * NEW v17.0.0: Get creativity temperature for current move
22556| * Anneals from high exploration (early game) to low (late game)
22557| * Linear decay over temperatureDecayMoves
22558| */
22559|function getCreativityTemperature(moveNumber) {
22560|    const decayMoves = ALPHAZERO_ESSENCE.temperatureDecayMoves;
22561|    
22562|    if (moveNumber >= decayMoves) {
22563|        return ALPHAZERO_ESSENCE.temperatureEnd;
22564|    }
22565|    
22566|    // Linear annealing
22567|    const t = Math.max(
22568|        ALPHAZERO_ESSENCE.temperatureEnd,
22569|        ALPHAZERO_ESSENCE.temperatureStart - 
22570|        ((moveNumber / decayMoves) * (ALPHAZERO_ESSENCE.temperatureStart - ALPHAZERO_ESSENCE.temperatureEnd))
22571|    );
22572|    
22573|    return t;
22574|}
22575|
22576|/**
22577| * NEW v18.0.0: Check absolute safety limit (TRUE ALPHAZERO)
22578| * Returns true if move passes safety check, false otherwise
22579| * ABSOLUTE RULE: engineTopScore - combinedScore <= safetyDropLimit
22580| */
