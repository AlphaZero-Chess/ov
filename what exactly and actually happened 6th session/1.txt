Now I have a comprehensive understanding. Let me view the current state of the file to understand what has been implemented and what's missing:
Action: file_editor view /app/Lichess Bot-AlphaZero-Pure.user.js
Observation: /app/Lichess Bot-AlphaZero-Pure.user.js:
2325|function v40SuperhumanBeastEvaluate(fen, candidateMove, depth = 100) {
2326|    if (!CONFIG.v40Enabled) {
2327|        return v38SuperhumanMCTSEvaluate(fen, candidateMove, depth);
2328|    }
2329|    
2330|    try {
2331|        const board = parseFenToBoard(fen);
2332|        const activeColor = fen.split(' ')[1];
2333|        const moveNumber = parseInt(fen.split(' ')[5]) || 1;
2334|        
2335|        debugLog("[V40_EVAL]", `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
2336|        debugLog("[V40_EVAL]", `ðŸ¦ SUPERHUMAN BEAST v40.1 EVALUATION for ${candidateMove}`);
2337|        debugLog("[V40_EVAL]", `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
2338|        
2339|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2340|        // PHASE 1: MULTI-PASS ZERO BLUNDER VERIFICATION (12 passes)
2341|        // "Eliminate blunders by predicting outcomes 30+ moves deep"
2342|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2343|        
2344|        const blunderResult = v40MultiPassBlunderCheck(fen, candidateMove, board, activeColor);
2345|        if (!blunderResult.safe) {
2346|            debugLog("[V40_EVAL]", `ðŸš¨ BLUNDER DETECTED: ${blunderResult.reason}`);
2347|            return blunderResult.penalty;
2348|        }
2349|        
2350|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2351|        // PHASE 2: IMMEDIATE REJECTION OF TERRIBLE MOVES
2352|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2353|        
2354|        const rejectResult = v40ImmediateMoveRejection(candidateMove, board, activeColor, moveNumber);
2355|        if (rejectResult.reject) {
2356|            debugLog("[V40_EVAL]", `ðŸ›‘ IMMEDIATE REJECTION: ${rejectResult.reason}`);
2357|            return rejectResult.penalty;
2358|        }
2359|        
2360|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2361|        // PHASE 3: VALUE NETWORK EMULATION (Holistic Position Evaluation)
2362|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2363|        
2364|        const valueScore = v40ValueNetworkEmulation(fen, candidateMove, board, activeColor, moveNumber) * 1000;
2365|        
2366|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2367|        // PHASE 4: 30+ MOVE STRATEGIC HORIZON
2368|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2369|        
2370|        const strategicScore = v40DeepStrategicEvaluation(fen, candidateMove, board, activeColor, moveNumber);
2371|        
2372|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2373|        // PHASE 5: FLAWLESS ENDGAME TECHNIQUE
2374|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2375|        
2376|        const endgameScore = v40FlawlessEndgameEvaluation(fen, candidateMove, board, activeColor);
2377|        
2378|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2379|        // PHASE 6: WEB-WEAVING (Multi-Front Pressure)
2380|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2381|        
2382|        const webWeavingScore = v40WebWeavingEvaluation(fen, candidateMove, board, activeColor);
2383|        
2384|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2385|        // PHASE 7: PATTERN RECOGNITION
2386|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2387|        
2388|        const patternScore = v40PatternRecognition(fen, candidateMove, board, activeColor);
2389|        
2390|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2391|        // PHASE 8: DELAYED GRATIFICATION
2392|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2393|        
2394|        const delayedScore = v40DelayedGratificationEval(fen, candidateMove, board, activeColor, moveNumber);
2395|        
2396|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2397|        // PHASE 9: RESILIENCE & COUNTERPLAY
2398|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2399|        
2400|        const resilienceScore = v40ResilienceEvaluation(fen, candidateMove, board, activeColor);
2401|        
2402|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2403|        // PHASE 10: INITIATIVE & TEMPO
2404|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2405|        
2406|        const initiativeScore = v40InitiativeEvaluation(fen, candidateMove, board, activeColor, moveNumber);
2407|        
2408|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2409|        // v40.1: ADDITIONAL PHASES FOR TRUE ALPHAZERO DOMINANCE
2410|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2411|        
2412|        // PHASE 11: King Safety Deep Analysis
2413|        const kingSafetyScore = v40DeepKingSafetyAnalysis(fen, candidateMove, board, activeColor, moveNumber);
2414|        
2415|        // PHASE 12: File and Diagonal Control
2416|        const fileControlScore = v40FileAndDiagonalControl(fen, candidateMove, board, activeColor);
2417|        
2418|        // PHASE 13: Piece Coordination (web-weaving precursor)
2419|        const coordinationScore = v40PieceCoordinationEval(fen, candidateMove, board, activeColor);
2420|        
2421|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2422|        // v40.1: COMBINED SUPERHUMAN BEAST SCORE â€” REBALANCED WEIGHTS
2423|        // Increased emphasis on safety, file control, and initiative
2424|        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2425|        
2426|        const totalScore = 
2427|            blunderResult.score * 0.08 +          // 8% tactical safety base
2428|            valueScore * 0.20 +                   // 20% value network (holistic)
2429|            strategicScore * 0.15 +               // 15% long-term strategy
2430|            endgameScore * 0.08 +                 // 8% endgame technique
2431|            webWeavingScore * 0.08 +              // 8% web-weaving
2432|            patternScore * 0.06 +                 // 6% pattern recognition
2433|            delayedScore * 0.05 +                 // 5% delayed gratification
2434|            resilienceScore * 0.04 +              // 4% resilience
2435|            initiativeScore * 0.10 +              // 10% initiative (INCREASED)
2436|            kingSafetyScore * 0.08 +              // 8% king safety (NEW)
2437|            fileControlScore * 0.04 +             // 4% file control (NEW)
2438|            coordinationScore * 0.04;             // 4% coordination (NEW)
2439|        
2440|        debugLog("[V40_EVAL]", `ðŸ“Š Score breakdown for ${candidateMove}:`);
2441|        debugLog("[V40_EVAL]", `   Tactical: ${blunderResult.score.toFixed(0)}`);
2442|        debugLog("[V40_EVAL]", `   Value: ${valueScore.toFixed(0)}`);
2443|        debugLog("[V40_EVAL]", `   Strategic: ${strategicScore.toFixed(0)}`);
2444|        debugLog("[V40_EVAL]", `   Endgame: ${endgameScore.toFixed(0)}`);
2445|        debugLog("[V40_EVAL]", `   WebWeave: ${webWeavingScore.toFixed(0)}`);
2446|        debugLog("[V40_EVAL]", `   Pattern: ${patternScore.toFixed(0)}`);
2447|        debugLog("[V40_EVAL]", `   Delayed: ${delayedScore.toFixed(0)}`);
2448|        debugLog("[V40_EVAL]", `   Resilience: ${resilienceScore.toFixed(0)}`);
2449|        debugLog("[V40_EVAL]", `   Initiative: ${initiativeScore.toFixed(0)}`);
2450|        debugLog("[V40_EVAL]", `   KingSafety: ${kingSafetyScore.toFixed(0)}`);
2451|        debugLog("[V40_EVAL]", `   FileControl: ${fileControlScore.toFixed(0)}`);
2452|        debugLog("[V40_EVAL]", `   Coordination: ${coordinationScore.toFixed(0)}`);
2453|        debugLog("[V40_EVAL]", `   ðŸ¦ SUPERHUMAN TOTAL: ${totalScore.toFixed(1)}`);
2454|        
2455|        return totalScore;
2456|        
2457|    } catch (e) {
2458|        debugLog("[V40_EVAL]", `âš ï¸ Error: ${e.message}`);
2459|        return v38SuperhumanMCTSEvaluate(fen, candidateMove, depth);
2460|    }
2461|}
2462|
2463|/**
2464| * v40.1: Deep King Safety Analysis
2465| * Prevents disasters from weak king positions
2466| */
2467|function v40DeepKingSafetyAnalysis(fen, move, board, activeColor, moveNumber) {
2468|    let score = 0;
2469|    
2470|    try {
2471|        const ourKing = findKing(board, activeColor);
2472|        if (!ourKing) return 0;
2473|        
2474|        const kingFile = ourKing.charCodeAt(0) - 'a'.charCodeAt(0);
2475|        const kingRank = parseInt(ourKing[1]) - 1;
2476|        
2477|        // After castling, king should be safe
2478|        const hasCastled = (activeColor === 'w' && (kingFile === 6 || kingFile === 2)) ||
2479|                          (activeColor === 'b' && (kingFile === 6 || kingFile === 2));
2480|        
2481|        if (!hasCastled && moveNumber > 10) {
2482|            score -= 300;  // Penalty for not castling
2483|        }
2484|        
2485|        // Evaluate pawn shield
2486|        if (hasCastled) {
2487|            const shieldScore = evaluatePawnShield(board, activeColor, ourKing);
2488|            score += shieldScore;
2489|        }
2490|        
2491|        // King in center after move 10 is dangerous
2492|        if (moveNumber > 10 && kingFile >= 3 && kingFile <= 4) {
2493|            score -= 400;
2494|        }
2495|        
2496|    } catch (e) {
2497|        debugLog("[V40_KING]", `Error: ${e.message}`);
2498|    }
2499|    
2500|    return score;
2501|}
2502|
2503|/**
2504| * v40.1: File and Diagonal Control
2505| */
2506|function v40FileAndDiagonalControl(fen, move, board, activeColor) {
2507|    let score = 0;
2508|    
2509|    try {
2510|        const toSquare = move.substring(2, 4);
2511|        const movingPiece = board.get(move.substring(0, 2));
2512|        
2513|        if (!movingPiece) return 0;
2514|        
2515|        const pieceType = movingPiece.toLowerCase();
2516|        
2517|        // Rook file control
2518|        if (pieceType === 'r') {
2519|            const file = toSquare[0];
2520|            if (isOpenFile(file, board)) {
2521|                score += 400;
2522|            }
2523|        }
2524|        
2525|        // Bishop diagonal control
2526|        if (pieceType === 'b') {
2527|            if (isLongDiagonal(toSquare)) {
2528|                score += 300;
2529|            }
2530|        }
2531|        
2532|        // Queen file/diagonal control
2533|        if (pieceType === 'q') {
2534|            const file = toSquare[0];
2535|            if (isOpenFile(file, board)) {
2536|                score += 200;
2537|            }
2538|        }
2539|        
2540|    } catch (e) {
2541|        debugLog("[V40_FILE_DIAG]", `Error: ${e.message}`);
2542|    }
2543|    
2544|    return score;
2545|}
2546|
2547|/**
2548| * v40.1: Piece Coordination Evaluation
2549| */
2550|function v40PieceCoordinationEval(fen, move, board, activeColor) {
2551|    let score = 0;
2552|    
2553|    try {
2554|        const toSquare = move.substring(2, 4);
2555|        const toFile = toSquare.charCodeAt(0) - 'a'.charCodeAt(0);
2556|        const toRank = parseInt(toSquare[1]) - 1;
2557|        
2558|        // Count friendly pieces near the target square
2559|        let friendlyNearby = 0;
2560|        for (const [square, piece] of board) {
2561|            if (!piece) continue;
2562|            const isOurs = (piece === piece.toUpperCase()) === (activeColor === 'w');
2563|            if (!isOurs) continue;
2564|            
2565|            const sqFile = square.charCodeAt(0) - 'a'.charCodeAt(0);
2566|            const sqRank = parseInt(square[1]) - 1;
2567|            
2568|            if (Math.abs(sqFile - toFile) <= 2 && Math.abs(sqRank - toRank) <= 2) {
2569|                friendlyNearby++;
2570|            }
2571|        }
2572|        
2573|        score += friendlyNearby * 50;  // Bonus for piece coordination
2574|        
2575|    } catch (e) {
2576|        debugLog("[V40_COORD]", `Error: ${e.message}`);
2577|    }
2578|    
2579|    return score;
2580|}
2581|
2582|/**
2583| * v40: Multi-Pass Blunder Check (12 verification passes)
2584| */
2585|function v40MultiPassBlunderCheck(fen, move, board, activeColor) {
2586|    const result = { safe: true, score: 100, reason: '', penalty: 0 };
2587|    const passes = CONFIG.v40VerificationPasses || 12;
2588|    
2589|    try {
2590|        debugLog("[V40_BLUNDER]", `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
2591|        debugLog("[V40_BLUNDER]", `ðŸ” ${passes}-PASS BLUNDER VERIFICATION for ${move}`);
2592|        debugLog("[V40_BLUNDER]", `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
2593|        
2594|        // Pass 1: Standard tactical scan (uses existing comprehensive scan)
2595|        const tacticalScan = comprehensiveTacticalScan(fen, move);
2596|        if (tacticalScan && !tacticalScan.safe) {
2597|            result.safe = false;
2598|            result.reason = `Pass 1 - Tactical danger: ${tacticalScan.totalDanger}`;
2599|            result.penalty = -tacticalScan.totalDanger * 5;
2600|            debugLog("[V40_BLUNDER]", `ðŸš¨ Pass 1 FAILED: ${result.reason}`);
2601|            return result;
2602|        }
2603|        debugLog("[V40_BLUNDER]", `âœ… Pass 1 (Tactical Scan): CLEAR`);
2604|        
2605|        // Pass 2: Hanging piece check
2606|        const hangingCheck = v40CheckHangingPieces(fen, move, board, activeColor);
2607|        if (hangingCheck.isHanging) {
2608|            result.safe = false;
2609|            result.reason = `Pass 2 - Hanging piece: ${hangingCheck.piece} on ${hangingCheck.square}`;
2610|            result.penalty = -hangingCheck.value * 3;
2611|            debugLog("[V40_BLUNDER]", `ðŸš¨ Pass 2 FAILED: ${result.reason}`);
2612|            return result;
2613|        }
2614|        debugLog("[V40_BLUNDER]", `âœ… Pass 2 (Hanging Pieces): CLEAR`);
2615|        
2616|        // Pass 3: Fork detection
2617|        const forkCheck = v40CheckForForks(fen, move, board, activeColor);
2618|        if (forkCheck.forkThreat) {
2619|            result.safe = false;
2620|            result.reason = `Pass 3 - Fork threat: ${forkCheck.details}`;
2621|            result.penalty = -forkCheck.value * 2;
2622|            debugLog("[V40_BLUNDER]", `ðŸš¨ Pass 3 FAILED: ${result.reason}`);
2623|            return result;
2624|        }
2625|        debugLog("[V40_BLUNDER]", `âœ… Pass 3 (Fork Detection): CLEAR`);
2626|        
2627|        // Pass 4: Pin/Skewer detection
2628|        const pinCheck = v40CheckPinsSkewers(fen, move, board, activeColor);
2629|        if (pinCheck.dangerous) {
2630|            result.safe = false;
2631|            result.reason = `Pass 4 - Pin/Skewer: ${pinCheck.details}`;
2632|            result.penalty = -pinCheck.value * 2;
2633|            debugLog("[V40_BLUNDER]", `ðŸš¨ Pass 4 FAILED: ${result.reason}`);
2634|            return result;
2635|        }
2636|        debugLog("[V40_BLUNDER]", `âœ… Pass 4 (Pin/Skewer): CLEAR`);
2637|        
2638|        // Pass 5: Back rank mate check
2639|        const backRankCheck = v40CheckBackRankMate(fen, move, board, activeColor);
2640|        if (backRankCheck.threat) {
2641|            result.safe = false;
2642|            result.reason = `Pass 5 - ${backRankCheck.details}`;
2643|            result.penalty = -10000;
2644|            debugLog("[V40_BLUNDER]", `ðŸš¨ Pass 5 FAILED: ${result.reason}`);
2645|            return result;
2646|        }
2647|        debugLog("[V40_BLUNDER]", `âœ… Pass 5 (Back Rank Mate): CLEAR`);
2648|        
2649|        // Pass 6: Discovered attack check
2650|        const discoveredCheck = v40CheckDiscoveredAttacks(fen, move, board, activeColor);
